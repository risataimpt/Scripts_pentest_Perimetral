import subprocess
import threading

commands = [

    'crackmapexec mssql ips.txt',
    'crackmapexec mssql ips.txt -M test_connection\n',
    'crackmapexec ftp ips.txt',
    'crackmapexec winrm ips.txt',
    'crackmapexec rdp ips.txt',
    'crackmapexec ssh ips.txt',
    'crackmapexec ldap ips.txt -M user-desc\n',
    'crackmapexec ldap ips.txt',
    'crackmapexec smb ips.txt',
    'crackmapexec smb ips.txt -M spider_plus\n',
    'crackmapexec smb ips.txt -M nopac\n',
    'crackmapexec smb ips.txt -M petitpotam\n',
    'crackmapexec smb ips.txt -M zerologon\n',
    'crackmapexec smb ips.txt -M ms17-010',
    'crackmapexec smb ips.txt -M ioxidresolver\n',
    'crackmapexec smb ips.txt --users',
    'crackmapexec smb ips.txt --shares',
    'crackmapexec smb ips.txt -M shadowcoerce\n',
    'crackmapexec smb ips.txt -M test_connection\n'
]

output_file = "crackmapexec_resultados.txt"
def run_command(command):
    with open(output_file, 'a') as output:
        process = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, text=True)
        for line in process.stdout:
            print(line.strip())
            output.write(line)

threads = []
for cmd in commands:
    thread = threading.Thread(target=run_command, args=(cmd,))
    threads.append(thread)
    thread.start()

for thread in threads:
    thread.join()

print(f"Los resultados estan en '{output_file}'.")
